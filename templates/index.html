<!DOCTYPE html>
<html lang="en" data-bs-theme="dark">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Zobo - Your AI Friend</title>
    
    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    
    <!-- Font Awesome for icons -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <!-- Google Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&family=Roboto:wght@300;400;500;700&family=Open+Sans:wght@300;400;600;700&family=Lato:wght@300;400;700&family=Poppins:wght@300;400;500;600;700&family=Montserrat:wght@300;400;500;600;700&family=Nunito:wght@300;400;600;700&family=Source+Sans+Pro:wght@300;400;600;700&family=Raleway:wght@300;400;500;600;700&family=Ubuntu:wght@300;400;500;700&family=Playfair+Display:wght@400;500;600;700&family=Merriweather:wght@300;400;700&family=Crimson+Text:wght@400;600&family=JetBrains+Mono:wght@300;400;500;600&family=Fira+Code:wght@300;400;500;600&display=swap" rel="stylesheet">
    
    <!-- BB Jack Armstrong Font -->
    <link href="https://fonts.googleapis.com/css2?family=Creepster&display=swap" rel="stylesheet">
    
    <!-- PWA Manifest -->
    <link rel="manifest" href="{{ url_for('static', filename='manifest.json') }}">
    
    <!-- PWA Meta Tags -->
    <meta name="theme-color" content="#007bff">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="apple-mobile-web-app-title" content="Zobo">
    <link rel="apple-touch-icon" href="{{ url_for('static', filename='icons/icon-192x192.png') }}">
    
    <!-- Google Drive Picker API -->
    <script src="https://apis.google.com/js/api.js"></script>
    
    <!-- Custom CSS -->
    <link rel="stylesheet" href="{{ url_for('static', filename='css/custom.css') }}">
</head>
<body>
    <div class="chat-container">
        <!-- Header -->
        <header class="chat-header">
            <div class="header-content">
                <div class="logo-section">
                    <div class="robot-logo">
                        <i class="fas fa-robot"></i>
                    </div>
                    <div class="brand-info">
                        <h1 class="brand-title">Zobo</h1>
                        <p class="brand-subtitle">Your AI Friend</p>
                    </div>
                    <!-- Temporary prominent timer button -->
                    <button class="btn btn-primary btn-sm me-2" id="timerBtnTemp" data-bs-toggle="modal" data-bs-target="#timerModal" title="Open Timer">
                        ‚è∞ Timer
                    </button>
                </div>
                <div class="header-actions">
                    <button class="action-btn" id="settingsBtn" title="Settings" data-bs-toggle="modal" data-bs-target="#settingsModal">
                        <i class="fas fa-cog"></i>
                    </button>
                    <button class="action-btn" id="timerBtn" title="Timer & Alarms" data-bs-toggle="modal" data-bs-target="#timerModal">
                        <i class="fas fa-clock"></i>
                    </button>
                    <button class="action-btn" id="voiceStatusBtn" title="Voice API Status">
                        <i class="fas fa-microphone"></i>
                    </button>
                    <button class="action-btn" id="clearBtn" title="Clear conversation">
                        <i class="fas fa-trash"></i>
                    </button>
                    <button class="action-btn" id="statusBtn" title="Check API status">
                        <i class="fas fa-info-circle"></i>
                    </button>
                </div>
            </div>
        </header>

        <!-- Status Alert -->
        <div id="statusAlert" class="status-alert alert-warning d-none" role="alert">
            <i class="fas fa-exclamation-triangle"></i>
            <span id="statusMessage"></span>
            <button type="button" class="alert-close" data-bs-dismiss="alert">
                <i class="fas fa-times"></i>
            </button>
        </div>

        <!-- Chat Messages Container -->
        <div class="chat-messages" id="chatContainer">
            <div class="messages-wrapper">
                <div id="messagesArea">
                    <!-- Welcome message -->
                    <div class="message assistant-message">
                        <div class="message-avatar">
                            <div class="avatar-circle">
                                <i class="fas fa-robot"></i>
                            </div>
                        </div>
                        <div class="message-content">
                            <div class="message-header">
                                <span class="message-name">Zobo</span>
                                <span class="message-time">Just now</span>
                            </div>
                            <div class="message-text">
                                Hey there! I'm Zobo, your AI friend! Think of me as that buddy who's always ready to chat, help out, or just listen. Whether you want to talk about your day, work through problems together, or explore ideas - I'm here for you. What's on your mind?
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- Loading indicator -->
                <div id="loadingIndicator" class="message assistant-message d-none">
                    <div class="message-avatar">
                        <div class="avatar-circle">
                            <i class="fas fa-robot"></i>
                        </div>
                    </div>
                    <div class="message-content">
                        <div class="message-header">
                            <span class="message-name">Zobo</span>
                            <span class="message-time">Typing...</span>
                        </div>
                        <div class="message-text">
                            <div class="typing-indicator">
                                <span></span>
                                <span></span>
                                <span></span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Message Input Area -->
        <div class="chat-input-area">
            <div class="input-container">
                <form id="chatForm" class="input-form">
                    <div class="input-wrapper">
                        <button class="attach-btn" type="button" id="attachBtn" data-bs-toggle="dropdown" aria-expanded="false" title="Attach files">
                            <i class="fas fa-plus"></i>
                        </button>
                        <ul class="dropdown-menu" id="attachMenu">
                            <li><a class="dropdown-item" href="#" id="localFileBtn"><i class="fas fa-file me-2"></i>Connect File to Zobo</a></li>
                            <li><a class="dropdown-item" href="#" id="oneDriveBtn"><i class="fab fa-microsoft me-2"></i>OneDrive</a></li>
                            <li><a class="dropdown-item" href="#" id="addLinkBtn"><i class="fas fa-link me-2"></i>Add Link</a></li>
                        </ul>
                        <button class="voice-btn" type="button" id="recordBtn" title="Record voice message">
                            <i class="fas fa-microphone"></i>
                        </button>
                        <textarea 
                            id="messageInput" 
                            class="message-input" 
                            placeholder="Message Zobo..."
                            rows="1"
                            maxlength="2000"
                        ></textarea>
                        <button class="voice-btn" type="button" id="speakBtn" title="Speak message">
                            <i class="fas fa-volume-up"></i>
                        </button>
                        <button class="send-btn" type="submit" id="sendBtn">
                            <i class="fas fa-paper-plane"></i>
                        </button>
                    </div>
                    <div class="input-footer">
                        <small class="char-count">
                            <span id="charCount">0</span>/2000
                        </small>
                    </div>
                </form>
            </div>
            <!-- Hidden file input -->
            <input type="file" id="fileInput" style="display: none;" multiple accept=".txt,.pdf,.doc,.docx,.jpg,.jpeg,.png,.gif">
        </div>
    </div>

    <!-- Timer/Alarm Modal -->
    <div class="modal fade" id="timerModal" tabindex="-1" aria-labelledby="timerModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <ul class="nav nav-tabs" id="timerTabs" role="tablist">
                        <li class="nav-item" role="presentation">
                            <button class="nav-link active" id="timer-tab" data-bs-toggle="tab" data-bs-target="#timer-pane" type="button" role="tab">
                                <i class="fas fa-hourglass-half me-2"></i>Timer
                            </button>
                        </li>
                        <li class="nav-item" role="presentation">
                            <button class="nav-link" id="alarm-tab" data-bs-toggle="tab" data-bs-target="#alarm-pane" type="button" role="tab">
                                <i class="fas fa-bell me-2"></i>Alarm
                            </button>
                        </li>
                        <li class="nav-item" role="presentation">
                            <button class="nav-link" id="stopwatch-tab" data-bs-toggle="tab" data-bs-target="#stopwatch-pane" type="button" role="tab">
                                <i class="fas fa-stopwatch me-2"></i>Stopwatch
                            </button>
                        </li>
                    </ul>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <div class="tab-content" id="timerTabsContent">
                        <!-- Timer Tab -->
                        <div class="tab-pane fade show active" id="timer-pane" role="tabpanel">
                            <div class="timer-controls">
                                <div class="timer-display">
                                    <span id="timerDisplay">00:00</span>
                                </div>
                                <div class="timer-inputs mb-3">
                                    <div class="row g-2">
                                        <div class="col">
                                            <input type="number" class="form-control" id="timerHours" min="0" max="23" value="0" placeholder="Hours">
                                        </div>
                                        <div class="col">
                                            <input type="number" class="form-control" id="timerMinutes" min="0" max="59" value="5" placeholder="Minutes">
                                        </div>
                                        <div class="col">
                                            <input type="number" class="form-control" id="timerSeconds" min="0" max="59" value="0" placeholder="Seconds">
                                        </div>
                                    </div>
                                </div>
                                <div class="mb-3">
                                    <input type="text" class="form-control" id="timerName" placeholder="Timer name (optional)">
                                </div>
                                <div class="timer-buttons">
                                    <button class="btn btn-primary" id="startTimerBtn">Start Timer</button>
                                    <button class="btn btn-warning d-none" id="pauseTimerBtn">Pause</button>
                                    <button class="btn btn-danger d-none" id="stopTimerBtn">Stop</button>
                                </div>
                            </div>
                            <div id="activeTimers" class="mt-4">
                                <h6>Active Timers</h6>
                                <div id="timerList"></div>
                            </div>
                        </div>
                        
                        <!-- Alarm Tab -->
                        <div class="tab-pane fade" id="alarm-pane" role="tabpanel">
                            <div class="alarm-controls">
                                <div class="alarm-inputs mb-3">
                                    <div class="row g-2">
                                        <div class="col">
                                            <input type="time" class="form-control" id="alarmTime">
                                        </div>
                                        <div class="col">
                                            <input type="text" class="form-control" id="alarmName" placeholder="Alarm name">
                                        </div>
                                    </div>
                                </div>
                                <div class="mb-3">
                                    <select class="form-select" id="alarmRepeat">
                                        <option value="none">One time</option>
                                        <option value="daily">Daily</option>
                                        <option value="weekdays">Weekdays</option>
                                        <option value="weekly">Weekly</option>
                                    </select>
                                </div>
                                <div class="alarm-buttons">
                                    <button class="btn btn-primary" id="setAlarmBtn">Set Alarm</button>
                                </div>
                            </div>
                            <div id="activeAlarms" class="mt-4">
                                <h6>Active Alarms</h6>
                                <div id="alarmList"></div>
                            </div>
                        </div>
                        
                        <!-- Stopwatch Tab -->
                        <div class="tab-pane fade" id="stopwatch-pane" role="tabpanel">
                            <div class="stopwatch-controls">
                                <div class="stopwatch-display">
                                    <span id="stopwatchDisplay">00:00:00</span>
                                </div>
                                <div class="mb-3">
                                    <input type="text" class="form-control" id="stopwatchName" placeholder="Stopwatch name (optional)">
                                </div>
                                <div class="stopwatch-buttons">
                                    <button class="btn btn-success" id="startStopwatchBtn">Start</button>
                                    <button class="btn btn-warning d-none" id="pauseStopwatchBtn">Pause</button>
                                    <button class="btn btn-danger d-none" id="resetStopwatchBtn">Reset</button>
                                </div>
                            </div>
                            <div id="stopwatchLaps" class="mt-4">
                                <h6>Lap Times</h6>
                                <div id="lapsList"></div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Settings Modal -->
    <div class="modal fade" id="settingsModal" tabindex="-1" aria-labelledby="settingsModalLabel" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="settingsModalLabel">
                        <i class="fas fa-cog me-2"></i>Settings
                    </h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <div class="settings-section mb-4">
                        <h6 class="settings-section-title">
                            <i class="fas fa-font me-2"></i>Typography
                        </h6>
                        <div class="setting-item">
                            <label for="fontSelect" class="form-label">Font Family</label>
                            <select class="form-select" id="fontSelect">
                                <optgroup label="Sans-serif Fonts">
                                    <option value="Inter">Inter (Default)</option>
                                    <option value="Roboto">Roboto</option>
                                    <option value="Open Sans">Open Sans</option>
                                    <option value="Lato">Lato</option>
                                    <option value="Poppins">Poppins</option>
                                    <option value="Montserrat">Montserrat</option>
                                    <option value="Nunito">Nunito</option>
                                    <option value="Source Sans Pro">Source Sans Pro</option>
                                    <option value="Raleway">Raleway</option>
                                    <option value="Ubuntu">Ubuntu</option>
                                </optgroup>
                                <optgroup label="Serif Fonts">
                                    <option value="Playfair Display">Playfair Display</option>
                                    <option value="Merriweather">Merriweather</option>
                                    <option value="Crimson Text">Crimson Text</option>
                                    <option value="Georgia">Georgia</option>
                                    <option value="Times New Roman">Times New Roman</option>
                                </optgroup>
                                <optgroup label="Monospace Fonts">
                                    <option value="JetBrains Mono">JetBrains Mono</option>
                                    <option value="Fira Code">Fira Code</option>
                                    <option value="Courier New">Courier New</option>
                                    <option value="Monaco">Monaco</option>
                                </optgroup>
                                <optgroup label="Display Fonts">
                                    <option value="Creepster">BB Jack Armstrong (Creepster)</option>
                                </optgroup>
                            </select>
                            <div class="form-text">Choose your preferred font for the entire application</div>
                        </div>
                        <div class="setting-item mt-3">
                            <label for="fontSizeSelect" class="form-label">Font Size</label>
                            <select class="form-select" id="fontSizeSelect">
                                <option value="small">Small (14px)</option>
                                <option value="medium" selected>Medium (15px)</option>
                                <option value="large">Large (16px)</option>
                                <option value="xl">Extra Large (18px)</option>
                            </select>
                        </div>
                    </div>
                    
                    <div class="settings-section">
                        <h6 class="settings-section-title">
                            <i class="fas fa-palette me-2"></i>Colors & Appearance
                        </h6>
                        <div class="setting-item">
                            <label for="backgroundThemeSelect" class="form-label">Background Theme</label>
                            <select class="form-select" id="backgroundThemeSelect">
                                <option value="dark">Dark (Default)</option>
                                <option value="darker">Darker</option>
                                <option value="blue-dark">Blue Dark</option>
                                <option value="purple-dark">Purple Dark</option>
                                <option value="green-dark">Green Dark</option>
                                <option value="custom-bg">Custom Color</option>
                            </select>
                            <div class="mt-2 d-none" id="customBgColorPicker">
                                <input type="color" class="form-control form-control-color" id="customBgColor" value="#1a1a1a" title="Choose background color">
                            </div>
                        </div>
                        
                        <div class="setting-item">
                            <label class="form-label">Message Bubble Colors</label>
                            <div class="row g-2">
                                <div class="col-6">
                                    <label for="assistantBubbleSelect" class="form-label small">AI Messages</label>
                                    <select class="form-select form-select-sm" id="assistantBubbleSelect">
                                        <option value="default">Default Gray</option>
                                        <option value="blue">Blue</option>
                                        <option value="green">Green</option>
                                        <option value="purple">Purple</option>
                                        <option value="orange">Orange</option>
                                        <option value="custom-assistant">Custom</option>
                                    </select>
                                    <div class="mt-1 d-none" id="customAssistantColorPicker">
                                        <input type="color" class="form-control form-control-color form-control-sm" id="customAssistantColor" value="#2d2d2d" title="AI message color">
                                    </div>
                                </div>
                                <div class="col-6">
                                    <label for="userBubbleSelect" class="form-label small">User Messages</label>
                                    <select class="form-select form-select-sm" id="userBubbleSelect">
                                        <option value="default">Default Blue</option>
                                        <option value="green">Green</option>
                                        <option value="purple">Purple</option>
                                        <option value="orange">Orange</option>
                                        <option value="red">Red</option>
                                        <option value="custom-user">Custom</option>
                                    </select>
                                    <div class="mt-1 d-none" id="customUserColorPicker">
                                        <input type="color" class="form-control form-control-color form-control-sm" id="customUserColor" value="#1e3a8a" title="User message color">
                                    </div>
                                </div>
                            </div>
                            <div class="form-text">Customize the colors of message bubbles</div>
                        </div>
                        
                        <div class="setting-item">
                            <div class="form-check form-switch">
                                <input class="form-check-input" type="checkbox" id="compactModeSwitch">
                                <label class="form-check-label" for="compactModeSwitch">
                                    Compact Mode
                                </label>
                            </div>
                            <div class="form-text">Reduce spacing between messages</div>
                        </div>
                        
                        <div class="setting-item">
                            <div class="d-flex gap-2">
                                <button type="button" class="btn btn-outline-primary btn-sm" id="previewColorsBtn">
                                    <i class="fas fa-eye me-1"></i>Preview
                                </button>
                                <button type="button" class="btn btn-outline-secondary btn-sm" id="resetColorsBtn">
                                    <i class="fas fa-undo me-1"></i>Reset Colors
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                    <button type="button" class="btn btn-primary" id="resetSettingsBtn">Reset to Defaults</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Bootstrap JS -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    
    <!-- Custom JavaScript -->
    <script src="{{ url_for('static', filename='js/chat.js') }}"></script>
    <script src="{{ url_for('static', filename='js/notifications.js') }}"></script>
    <script src="{{ url_for('static', filename='js/timer.js') }}"></script>
    <script src="{{ url_for('static', filename='js/settings.js') }}"></script>
    
    <!-- Service Worker Registration -->
    <script>
        if ('serviceWorker' in navigator) {
            window.addEventListener('load', function() {
                navigator.serviceWorker.register('/static/sw.js')
                    .then(function(registration) {
                        console.log('ServiceWorker registration successful with scope: ', registration.scope);
                    }, function(err) {
                        console.log('ServiceWorker registration failed: ', err);
                    });
            });
        }
        
        // PWA install prompt
        let deferredPrompt;
        window.addEventListener('beforeinstallprompt', (e) => {
            e.preventDefault();
            deferredPrompt = e;
            // Show install button or notification
        });
    </script>
</body>
</html>
